# php webshell detection

![未命名文件](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211107133622161-782042101.png)

## 原始数据集

benign samples : 1814 ,webshell samples:1637

有不同大小的webshell，而且有一些是加密过的，有一些没有。加密字符串会很长，需要使用编码和解码。加密后的代码更混乱，信息熵更大。

## 特征选取

|        特征        |                含义                |
| :----------------: | :--------------------------------: |
|    使用危险函数    | 主要是一些执行命令和危险的函数操作 |
|        长度        |           整个代码的长度           |
|      网络操作      |       使用关键词检测网络操作       |
|     最长行长度     |          最长的一行的长度          |
|      行长度熵      |           每一行长度的熵           |
|      标签个数      |              <的个数               |
|       信息熵       |        整个代码字符级别的熵        |
|     IC重合指数     |          选取相同的可能性          |
| 是否加密或者encode |     根据代码关键词判断是否编码     |
|   字符串最大长度   |                                    |

下面为各个特征的分布情况

![Figure_1](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106100529156-792249363.png)

![Figure_2](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106100813924-1021668596.png)

![Figure_3](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106100942948-1508445733.png)

![Figure_4](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106101524192-1278171600.png)





![Figure_](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106101750669-1161245455.png)



![Figure_6](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106101948175-845808178.png)

![Figure_7](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106102923213-581387463.png)

![Figure_8](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106105800217-2021316089.png)

![Figure_9](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106112052656-1929663757.png)

![Figure_10](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106131946868-1666238857.png)

![Figure_11](https://img2020.cnblogs.com/blog/2348945/202111/2348945-20211106142750142-178479915.png)

## 训练测试

训练前将特征矩阵进行一个标准化。

选用随机森林模型训练测试，计算袋外错误率，100颗树。

accuracy score: 0.9527027027027027
recall   score: 0.9557344064386318